{"version":3,"sources":["Android.js"],"names":["async","args","await","Binaries","addToPathAsync","let","result","spawnAsync","stdout","e","errorMessage","_","trim","stderr","startsWith","BEGINNING_OF_ADB_ERROR_MESSAGE","substring","length","Error","_getAdbOutputAsync","devices","lines","split","_isDeviceAttachedAsync","shift","listOfDevicesWithoutFirstLine","join","includes","_isDeviceAuthorizedAsync","packages","i","line","_isExpoInstalledAsync","info","regex","regexMatch","exec","_expoVersionAsync","versions","Versions","versionsAsync","installedVersion","semver","lt","androidVersion","Logger","notifications","warn","code","NotificationCode","OLD_ANDROID_APP_VERSION","_checkExpoUpToDateAsync","apkPath","path","_apkCacheDirectory","fs","exists","Api","downloadAsync","androidUrl","_downloadApkAsync","global","START_LOADING","STOP_LOADING","_installExpoAsync","_uninstallExpoAsync","_assertDeviceReadyAsync","installResult","status","_lastUrl","error","message","upgradeExpoAsync","genymotionMessage","url","output","CANT_START_ACTIVITY_ERROR","indexOf","_openUrlAsync","isDetached","installedExpo","Analytics","logEvent","platform","openUrlAsync","projectRoot","startAdbReverseAsync","projectUrl","UrlUtils","constructManifestUrlAsync","exp","ProjectUtils","readConfigJsonAsync","success","openProjectAsync","packagerInfo","ProjectSettings","readPackagerInfoAsync","expRc","readExpRcAsync","userDefinedAdbReversePorts","extraAdbReversePorts","adbReversePorts","packagerPort","expoServerPort","port","adbReverse","adbReverseRemove","stopAdbReverseAsync","debug","projectDir","splashScreenMode","get","generalSplashImagePath","chalk","italic","generalSplashImage","getImageDimensionsAsync","androidSplash","androidSplashImages","splashScreenDPIConstraints","dpi","sizeMultiplier","imageRelativePath","splashImage","width","height","expectedWidth","expectedHeight","push","sizeMatches","bold","some","map","checkSplashScreenImages","isPlatformSupported","process","dotExpoHomeDirectory","UserSettings","dir","mkdirpSync"],"mappings":"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","file":"../Android.js","sourcesContent":["/**\n * @flow\n */\n\nimport _ from 'lodash';\nimport fs from 'fs-extra';\nimport spawnAsync from '@expo/spawn-async';\nimport path from 'path';\nimport semver from 'semver';\nimport chalk from 'chalk';\n\nimport * as Analytics from './Analytics';\nimport * as Binaries from './Binaries';\nimport Api from './Api';\nimport Logger from './Logger';\nimport NotificationCode from './NotificationCode';\nimport * as ProjectUtils from './project/ProjectUtils';\nimport * as ProjectSettings from './ProjectSettings';\nimport UserSettings from './UserSettings';\nimport * as UrlUtils from './UrlUtils';\nimport * as Versions from './Versions';\nimport { getImageDimensionsAsync } from './tools/ImageUtils';\n\nlet _lastUrl = null;\nconst BEGINNING_OF_ADB_ERROR_MESSAGE = 'error: ';\nconst CANT_START_ACTIVITY_ERROR = 'Activity not started, unable to resolve Intent';\n\nexport function isPlatformSupported() {\n  return (\n    process.platform === 'darwin' || process.platform === 'win32' || process.platform === 'linux'\n  );\n}\n\nasync function _getAdbOutputAsync(args) {\n  await Binaries.addToPathAsync('adb');\n\n  try {\n    let result = await spawnAsync('adb', args);\n    return result.stdout;\n  } catch (e) {\n    let errorMessage = _.trim(e.stderr);\n    if (errorMessage.startsWith(BEGINNING_OF_ADB_ERROR_MESSAGE)) {\n      errorMessage = errorMessage.substring(BEGINNING_OF_ADB_ERROR_MESSAGE.length);\n    }\n    throw new Error(errorMessage);\n  }\n}\n\n// Device attached\nasync function _isDeviceAttachedAsync() {\n  let devices = await _getAdbOutputAsync(['devices']);\n  let lines = _.trim(devices).split(/\\r?\\n/);\n  // First line is \"List of devices\".\n  return lines.length > 1;\n}\n\nasync function _isDeviceAuthorizedAsync() {\n  let devices = await _getAdbOutputAsync(['devices']);\n  let lines = _.trim(devices).split(/\\r?\\n/);\n  lines.shift();\n  let listOfDevicesWithoutFirstLine = lines.join('\\n');\n  // result looks like \"072c4cf200e333c7\tdevice\" when authorized\n  // and \"072c4cf200e333c7\tunauthorized\" when not.\n  return listOfDevicesWithoutFirstLine.includes('device');\n}\n\n// Expo installed\nasync function _isExpoInstalledAsync() {\n  let packages = await _getAdbOutputAsync(['shell', 'pm', 'list', 'packages', '-f']);\n  let lines = packages.split(/\\r?\\n/);\n  for (let i = 0; i < lines.length; i++) {\n    let line = lines[i];\n    if (line.includes('host.exp.exponent.test')) {\n      continue;\n    }\n\n    if (line.includes('host.exp.exponent')) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nasync function _expoVersionAsync() {\n  let info = await _getAdbOutputAsync(['shell', 'dumpsys', 'package', 'host.exp.exponent']);\n\n  let regex = /versionName=([0-9.]+)/;\n  let regexMatch = regex.exec(info);\n  if (regexMatch.length < 2) {\n    return null;\n  }\n\n  return regexMatch[1];\n}\n\nasync function _checkExpoUpToDateAsync() {\n  let versions = await Versions.versionsAsync();\n  let installedVersion = await _expoVersionAsync();\n\n  if (!installedVersion || semver.lt(installedVersion, versions.androidVersion)) {\n    Logger.notifications.warn(\n      { code: NotificationCode.OLD_ANDROID_APP_VERSION },\n      'This version of the Expo app is out of date. Uninstall the app and run again to upgrade.'\n    );\n  }\n}\n\nfunction _apkCacheDirectory() {\n  let dotExpoHomeDirectory = UserSettings.dotExpoHomeDirectory();\n  let dir = path.join(dotExpoHomeDirectory, 'android-apk-cache');\n  fs.mkdirpSync(dir);\n  return dir;\n}\n\nasync function _downloadApkAsync() {\n  let versions = await Versions.versionsAsync();\n  let apkPath = path.join(_apkCacheDirectory(), `Exponent-${versions.androidVersion}.apk`);\n\n  if (await fs.exists(apkPath)) {\n    return apkPath;\n  }\n\n  await Api.downloadAsync(\n    versions.androidUrl,\n    path.join(_apkCacheDirectory(), `Exponent-${versions.androidVersion}.apk`)\n  );\n  return apkPath;\n}\n\nasync function _installExpoAsync() {\n  Logger.global.info(`Downloading latest version of Expo`);\n  Logger.notifications.info({ code: NotificationCode.START_LOADING });\n  let path = await _downloadApkAsync();\n  Logger.notifications.info({ code: NotificationCode.STOP_LOADING });\n  Logger.global.info(`Installing Expo on device`);\n  Logger.notifications.info({ code: NotificationCode.START_LOADING });\n  let result = await _getAdbOutputAsync(['install', path]);\n  Logger.notifications.info({ code: NotificationCode.STOP_LOADING });\n  return result;\n}\n\nasync function _uninstallExpoAsync() {\n  Logger.global.info('Uninstalling Expo from Android device.');\n  return await _getAdbOutputAsync(['uninstall', 'host.exp.exponent']);\n}\n\nexport async function upgradeExpoAsync(): Promise<boolean> {\n  try {\n    await _assertDeviceReadyAsync();\n\n    await _uninstallExpoAsync();\n    let installResult = await _installExpoAsync();\n    if (installResult.status !== 0) {\n      return false;\n    }\n\n    if (_lastUrl) {\n      Logger.global.info(`Opening ${_lastUrl} in Expo.`);\n      await _getAdbOutputAsync([\n        'shell',\n        'am',\n        'start',\n        '-a',\n        'android.intent.action.VIEW',\n        '-d',\n        _lastUrl,\n      ]);\n      _lastUrl = null;\n    }\n\n    return true;\n  } catch (e) {\n    Logger.global.error(e.message);\n    return false;\n  }\n}\n\n// Open Url\nasync function _assertDeviceReadyAsync() {\n  const genymotionMessage = `https://developer.android.com/studio/run/device.html#developer-device-options. If you are using Genymotion go to Settings -> ADB, select \"Use custom Android SDK tools\", and point it at your Android SDK directory.`;\n\n  if (!(await _isDeviceAttachedAsync())) {\n    throw new Error(\n      `No Android device found. Please connect a device and follow the instructions here to enable USB debugging:\\n${genymotionMessage}`\n    );\n  }\n\n  if (!(await _isDeviceAuthorizedAsync())) {\n    throw new Error(\n      `This computer is not authorized to debug the device. Please follow the instructions here to enable USB debugging:\\n${genymotionMessage}`\n    );\n  }\n}\n\nasync function _openUrlAsync(url: string) {\n  let output = await _getAdbOutputAsync([\n    'shell',\n    'am',\n    'start',\n    '-a',\n    'android.intent.action.VIEW',\n    '-d',\n    url,\n  ]);\n  if (output.includes(CANT_START_ACTIVITY_ERROR)) {\n    throw new Error(output.substring(output.indexOf('Error: ')));\n  }\n\n  return output;\n}\n\nasync function openUrlAsync(url: string, isDetached: boolean = false) {\n  try {\n    await _assertDeviceReadyAsync();\n\n    let installedExpo = false;\n    if (!isDetached && !(await _isExpoInstalledAsync())) {\n      await _installExpoAsync();\n      installedExpo = true;\n    }\n\n    if (!isDetached) {\n      _lastUrl = url;\n      _checkExpoUpToDateAsync(); // let this run in background\n    }\n\n    Logger.global.info(`Opening on Android device`);\n    try {\n      await _openUrlAsync(url);\n    } catch (e) {\n      if (isDetached) {\n        e.message = `Error running app. Have you installed the app already using Android Studio? Since you are detached you must build manually. ${\n          e.message\n        }`;\n      } else {\n        e.message = `Error running app. ${e.message}`;\n      }\n\n      throw e;\n    }\n\n    Analytics.logEvent('Open Url on Device', {\n      platform: 'android',\n      installedExpo,\n    });\n  } catch (e) {\n    e.message = `Error running adb: ${e.message}`;\n    throw e;\n  }\n}\n\nexport async function openProjectAsync(\n  projectRoot: string\n): Promise<{ success: true, url: string } | { success: false, error: string }> {\n  try {\n    await startAdbReverseAsync(projectRoot);\n\n    let projectUrl = await UrlUtils.constructManifestUrlAsync(projectRoot);\n    let { exp } = await ProjectUtils.readConfigJsonAsync(projectRoot);\n\n    await openUrlAsync(projectUrl, !!exp.isDetached);\n    return { success: true, url: projectUrl };\n  } catch (e) {\n    Logger.global.error(`Couldn't start project on Android: ${e.message}`);\n    return { success: false, error: e };\n  }\n}\n\n// Adb reverse\nexport async function startAdbReverseAsync(projectRoot: string) {\n  const packagerInfo = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n  const expRc = await ProjectUtils.readExpRcAsync(projectRoot);\n  const userDefinedAdbReversePorts = expRc.extraAdbReversePorts || [];\n\n  let adbReversePorts = [\n    packagerInfo.packagerPort,\n    packagerInfo.expoServerPort,\n    ...userDefinedAdbReversePorts,\n  ];\n\n  for (let port of adbReversePorts) {\n    if (!(await adbReverse(port))) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport async function stopAdbReverseAsync(projectRoot: string) {\n  const packagerInfo = await ProjectSettings.readPackagerInfoAsync(projectRoot);\n  const expRc = await ProjectUtils.readExpRcAsync(projectRoot);\n  const userDefinedAdbReversePorts = expRc.extraAdbReversePorts || [];\n\n  let adbReversePorts = [\n    packagerInfo.packagerPort,\n    packagerInfo.expoServerPort,\n    ...userDefinedAdbReversePorts,\n  ];\n\n  for (let port of adbReversePorts) {\n    await adbReverseRemove(port);\n  }\n}\n\nasync function adbReverse(port: number) {\n  if (!(await _isDeviceAuthorizedAsync())) {\n    return false;\n  }\n\n  try {\n    await _getAdbOutputAsync(['reverse', `tcp:${port}`, `tcp:${port}`]);\n    return true;\n  } catch (e) {\n    Logger.global.warn(`Couldn't adb reverse: ${e.message}`);\n    return false;\n  }\n}\n\nasync function adbReverseRemove(port: number) {\n  if (!(await _isDeviceAuthorizedAsync())) {\n    return false;\n  }\n\n  try {\n    await _getAdbOutputAsync(['reverse', '--remove', `tcp:${port}`]);\n    return true;\n  } catch (e) {\n    // Don't send this to warn because we call this preemptively sometimes\n    Logger.global.debug(`Couldn't adb reverse remove: ${e.message}`);\n    return false;\n  }\n}\n\nconst splashScreenDPIConstraints = [\n  {\n    dpi: 'mdpi',\n    sizeMultiplier: 1,\n  },\n  {\n    dpi: 'hdpi',\n    sizeMultiplier: 1.5,\n  },\n  {\n    dpi: 'xhdpi',\n    sizeMultiplier: 2,\n  },\n  {\n    dpi: 'xxhdpi',\n    sizeMultiplier: 3,\n  },\n  {\n    dpi: 'xxxhdpi',\n    sizeMultiplier: 4,\n  },\n];\n\nexport async function checkSplashScreenImages(projectDir: string) {\n  const { exp } = await ProjectUtils.readConfigJsonAsync(projectDir);\n  const splashScreenMode = _.get('android.splash.resizeMode') || _.get(exp, 'splash.resizeMode');\n  if (splashScreenMode === 'contain') {\n    return;\n  }\n\n  const generalSplashImagePath = _.get(exp, 'splash.image');\n  if (!generalSplashImagePath) {\n    Logger.global.warn(\n      `Couldn't read '${chalk.italic('splash.image')}' from ${chalk.italic(\n        'app.json'\n      )}. Provide asset that would serve as baseline splash image.`\n    );\n    return;\n  }\n  const generalSplashImage = await getImageDimensionsAsync(projectDir, generalSplashImagePath);\n  if (!generalSplashImage) {\n    Logger.global.warn(\n      `Couldn't read dimensions of provided splash image '${chalk.italic(\n        generalSplashImagePath\n      )}'. Does the file exist?`\n    );\n    return;\n  }\n\n  const androidSplash = _.get(exp, 'android.splash');\n  const androidSplashImages = [];\n  for (const { dpi, sizeMultiplier } of splashScreenDPIConstraints) {\n    const imageRelativePath = _.get(androidSplash, dpi);\n    if (imageRelativePath) {\n      const splashImage = await getImageDimensionsAsync(projectDir, imageRelativePath);\n      if (!splashImage) {\n        Logger.global.warn(\n          `Couldn't read dimensions of provided splash image '${chalk.italic(\n            splashImage\n          )}'. Does the file exist?`\n        );\n        continue;\n      }\n      const { width, height } = splashImage;\n      const expectedWidth = sizeMultiplier * generalSplashImage.width;\n      const expectedHeight = sizeMultiplier * generalSplashImage.height;\n      androidSplashImages.push({\n        dpi,\n        width,\n        height,\n        expectedWidth,\n        expectedHeight,\n        sizeMatches: width === expectedWidth && height === expectedHeight,\n      });\n    }\n  }\n\n  if (androidSplashImages.length === 0) {\n    Logger.global\n      .warn(`Splash resizeMode is set to 'cover', but you haven't provided any images for different DPIs.\nBe aware that your splash image will be used as xxxhdpi asset and its ${chalk.bold(\n      'actual size will be different'\n    )} depending on device's DPI.\nSee https://docs.expo.io/versions/latest/guides/splash-screens/#differences-between-environments---android for more information`);\n    return;\n  }\n\n  if (_.some(androidSplashImages, ({ sizeMatches }) => !sizeMatches)) {\n    Logger.global\n      .warn(`Splash resizeMode is set to 'cover' and you've provided different images for different DPIs,\nbut their sizes mismatch expected ones: [dpi: provided (expected)] ${androidSplashImages\n      .map(\n        ({ dpi, width, height, expectedWidth, expectedHeight }) =>\n          `${dpi}: ${width}x${height} (${expectedWidth}x${expectedHeight})`\n      )\n      .join(', ')}\nSee https://docs.expo.io/versions/latest/guides/splash-screens/#differences-between-environments---android for more information`);\n  }\n}\n"],"sourceRoot":"/xdl@53.7.2/src"}